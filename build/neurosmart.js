NS.BrainModule=function(a,b){this._parentDomElement=a;this._domElement=null;this._brainUrl="resources/brain.json";b&&(this._brainUrl=b);this._nsscene=this._brain=null;this._isLoaded=!1};NS.BrainModule.prototype.availableCommands=function(){return["setOpacity","setColor","rotateCamera","animationDuration"]};NS.BrainModule.prototype.performCommand=function(){this._nsscene.performCommand.apply(this._nsscene,arguments)};NS.BrainModule.prototype.isLoaded=function(){return this._isLoaded};
NS.BrainModule.prototype.load=function(a,b){this._domElement=document.createElement("div");this._domElement.id="brainModule";this._nsscene=new NS.Scene(this._domElement);NS.Utilities.asyncLoadTextFile(this._brainUrl,this,function(c){this._brain=JSON.parse(c).brain;var d=this._brain.length,e=0;c=function(){e++;e==d&&(this._isLoaded=!0,b.call(a))};for(var f=0;f<d;f++)this._nsscene.addObject(this._brain[f].nickName,this._brain[f].opacity,this._brain[f].color,this._brain[f].url,this,c)})};
NS.BrainModule.prototype.show=function(){this._domElement.appendChild(document.createTextNode(""));this._parentDomElement.appendChild(this._domElement);this._nsscene.load()};NS.BrainModule.prototype.hide=function(){this._parentDomElement.removeChild(this._domElement)};NS.BrainModule.prototype.playStep=function(){this._nsscene.playAnimations()};NS.Scene=function(a){this._domElement=a;this._sceneObjects={};this.animationManager=this._controls=this._camera=this._renderer=this._scene=null};
NS.Scene.prototype.performCommand=function(a,b,c,d){switch(a){case "setOpacity":console.log(b,c);this.setOpacity([b],c);break;case "setColor":this.setColor([b],c);break;case "rotateCamera":this.animationManager.addAnimatablePropertyToQueue.apply(this.animationManager,["camera",this._camera,this._nsscene,b,c,d]);break;case "animationDuration":this.animationManager.animationDuration=b}};
NS.Scene.prototype.load=function(){function a(){requestAnimationFrame(a);c._controls.update();c.animationManager.update();c._renderer.render(c._scene,c._camera)}this._scene=new THREE.Scene;this._renderer=new THREE.WebGLRenderer({alpha:!0});this._camera=new THREE.PerspectiveCamera(75,1,.1,1E3);this.animationManager=new NS.AnimationManager(this);this._controls=new THREE.TrackballControls(this._camera,this._domElement);this._controls.rotateSpeed=3;this._controls.zoomSpeed=2;this._controls.panSpeed=2;
this._controls.noZoom=!1;this._controls.noPan=!0;this._controls.staticMoving=!0;this._controls.maxDistance=200;this._controls.minDistance=10;var b=new THREE.AmbientLight(16777215);this._scene.add(b);b=new THREE.PointLight(16777215,4,200);b.position.set(0,0,200);this._scene.add(b);b=new THREE.PointLight(16777215,4,200);b.position.set(0,0,-200);this._scene.add(b);b=new THREE.PointLight(16777215,4,200);b.position.set(200,0,0);this._scene.add(b);b=new THREE.PointLight(16777215,4,200);b.position.set(-200,
0,0);this._scene.add(b);b=new THREE.PointLight(16777215,4,200);b.position.set(0,200,0);this._scene.add(b);b=new THREE.PointLight(16777215,4,200);b.position.set(0,-200,0);this._scene.add(b);this._camera.position.z=150;this._renderer.setSize(this._domElement.clientWidth,this._domElement.clientHeight);this._renderer.setClearColor(0,0);this._domElement.appendChild(this._renderer.domElement);this.addComponentsToScene();var c=this;window.onresize=function(){c._renderer.setSize(c._domElement.clientWidth,
c._domElement.clientHeight)};a();this._renderer.domElement.onclick=function(a){var b;b=a.x;a=a.y;b-=c._domElement.offsetLeft;a-=c._domElement.offsetTop;console.log("Click",b,a);b=(new THREE.Vector3(b,a,1)).unproject(c._camera);b=(new THREE.Raycaster(c._camera.position,b.sub(c._camera.position).normalize())).intersectObjects(d,!0);for(a=0;a<b.length;a++);};for(var d=[],b=Object.getOwnPropertyNames(this._sceneObjects),e=0;e<b.length;e++)d.push(this._sceneObjects[b[e]])};
NS.Scene.prototype.setInteractionEnabled=function(a){this._controls.enabled=a};NS.Scene.prototype.addComponentsToScene=function(){for(var a=Object.getOwnPropertyNames(this._sceneObjects),b=0;b<a.length;b++)this._scene.add(this._sceneObjects[a[b]])};
NS.Scene.prototype.addObject=function(a,b,c,d,e,f){var g=this;(new THREE.OBJLoader).load(d,function(d){d.children[0].material=new THREE.MeshPhongMaterial({wireframe:!1,ambient:5592405,color:c,specular:16777215,shininess:20,shading:THREE.SmoothShading,transparent:!0,opacity:b});g._sceneObjects[a]=d;f.call(e)})};NS.Scene.prototype.playAnimations=function(){this.animationManager.play(10)};
NS.Scene.prototype.setOpacity=function(a,b){for(var c=0;c<a.length;c++)this._sceneObjects[a[c]].children[0].material.opacity=b};NS.Scene.prototype.setColor=function(a,b){for(var c=0;c<a.length;c++)this._sceneObjects[a[c]].children[0].material.color=new THREE.Color(b)};NS.Scene.prototype.rotateAroundZ=function(a){var b=this._camera.position.x,c=this._camera.position.z;this._camera.position.x=b*Math.cos(a)+c*Math.sin(a);this._camera.position.z=c*Math.cos(a)-b*Math.sin(a)};
NS.Scene.prototype.rotateAroundX=function(a){var b=this._camera.position.y,c=this._camera.position.z;this._camera.position.y=b*Math.cos(a)+c*Math.sin(a);this._camera.position.z=c*Math.cos(a)-b*Math.sin(a)};NS.AnimationManager=function(a){this._animationQueue=[];this._isAnimating=!1;this._elapsedTime=this._lastTime=0;this._nsscene=a;this._test=0;this.animationDuration};NS.AnimationManager.prototype.addAnimatablePropertyToQueue=function(){this._animationQueue.push(arguments)};
NS.AnimationManager.prototype.update=function(){if(this._isAnimating){var a=Date.now(),b;b=0==this._lastTime?0:a-this._lastTime;this._elapsedTime+=b;for(var c=0;c<this._animationQueue.length;c++){var d=this._animationQueue[c];switch(d[0]){case "camera":var e=d[1],d=d[3];this._nsscene.rotateAroundX(b/(1E3*this.animationDuration)*d);this._test+=b/(1E3*this.animationDuration)*d;console.log(this._test);console.log(b/(1E3*this.animationDuration)*d);e.lookAt(new THREE.Vector3(0,0,0))}}this._elapsedTime>=
1E3*this.animationDuration&&(this._isAnimating=!1,this._animationQueue=[]);this._lastTime=a}};NS.AnimationManager.prototype.play=function(){this._elapsedTime=this._lastTime=0;this._isAnimating=!0};var NS=NS||{};NS.Scenario=function(a){this._controlsModule=this._mediaModule=this._consoleModule=this._brainModule=this._scenarioUrl=this._scenarioPlayer=null;this._containerElement=a};
NS.Scenario.prototype.init=function(){var a=new NS.SpinningWheel(this._containerElement);a.show();var b=function(){this._consoleModule.isLoaded()&&this._mediaModule.isLoaded()&&this._brainModule.isLoaded()&&this._scenarioPlayer.isLoaded()&&(this._consoleModule.show(),this._brainModule.show(),this._mediaModule.show(),this._controlsModule.show(),a.hide())};this._brainModule=new NS.BrainModule(this._containerElement);this._consoleModule=new NS.ConsoleModule(this._containerElement);this._mediaModule=
new NS.MediaModule(this._containerElement);this._scenarioPlayer=new NS.ScenarioPlayer(this._scenarioUrl,this._mediaModule,this._consoleModule,this._brainModule);this._controlsModule=new NS.ControlsModule(this._containerElement,this._scenarioPlayer,this._scenarioPlayer.previousStep,this._scenarioPlayer.nextStep);this._brainModule.load(this,b);this._consoleModule.load(this,b);this._mediaModule.load(this,b);this._scenarioPlayer.load(this,b)};
NS.Scenario.prototype.playScenario=function(a){this._scenarioUrl=a;scenario.init()};NS.ScenarioPlayer=function(a,b,c,d){this._scenarioUrl=a;this._mediaModule=b;this._consoleModule=c;this._brainModule=d;this._scenario=null;this._currentStep=-1;this._numberOfSteps=0;this._isLoaded=!1;this._commandDispatcher=null};
NS.ScenarioPlayer.prototype.load=function(a,b){var c=[this._mediaModule,this._consoleModule,this._brainModule];this._commandDispatcher=[];for(var d=0;d<c.length;d++)for(var e=c[d].availableCommands(),f=0;f<e.length;f++)this._commandDispatcher[e[f]]=c[d];NS.Utilities.asyncLoadTextFile(this._scenarioUrl,this,function(c){this._scenario=JSON.parse(c);this._numberOfSteps=this._scenario.sequences.length;c=this._scenario.media;for(var d=0;d<c.length;d++)this._mediaModule.addMedia(c[d]);this._isLoaded=!0;
b.call(a)})};NS.ScenarioPlayer.prototype.isLoaded=function(){return this._isLoaded};NS.ScenarioPlayer.prototype.nextStep=function(){this._currentStep<this._numberOfSteps-1&&(this._currentStep++,this.playCurrentStep())};NS.ScenarioPlayer.prototype.previousStep=function(){0<this._currentStep&&(this._currentStep--,this.playCurrentStep())};
NS.ScenarioPlayer.prototype.playCurrentStep=function(){for(var a=this._scenario.sequences[this._currentStep].actions,b=0;b<a.length;b++){for(var c=a[b],d=c.action,e=this._commandDispatcher[d],f=[],g=Object.getOwnPropertyNames(c),h=0;h<g.length;h++)f.push(c[g[h]]);e.performCommand.apply(this._commandDispatcher[d],f);b==a.length-1&&this._brainModule.playStep()}};NS.SpinningWheel=function(a){this._parentDomElement=a;this._domElement=null};
NS.SpinningWheel.prototype.show=function(){this._domElement=document.createElement("div");this._domElement.id="spinningWheel";this._parentDomElement.appendChild(this._domElement)};NS.SpinningWheel.prototype.hide=function(){this._parentDomElement.removeChild(this._domElement)};NS.ConsoleModule=function(a){this._parentDomElement=a;this._domElement=null;this._isLoaded=!1};NS.ConsoleModule.prototype.availableCommands=function(){return["printHtml","printLine"]};
NS.ConsoleModule.prototype.performCommand=function(a,b){switch(a){case "printLine":this.printLine(b);break;case "printHtml":this.printHTML(b)}};NS.ConsoleModule.prototype.isLoaded=function(){return this._isLoaded};NS.ConsoleModule.prototype.load=function(a,b){this._domElement=document.createElement("div");this._domElement.id="consoleModule";this._isLoaded=!0;b.call(a)};NS.ConsoleModule.prototype.show=function(){this._domElement.appendChild(document.createTextNode(""));this._parentDomElement.appendChild(this._domElement)};
NS.ConsoleModule.prototype.hide=function(){this._parentDomElement.removeChild(this._domElement)};NS.ConsoleModule.prototype.printLine=function(a){this._domElement.innerHTML+="<p>"+a+"</p>"};NS.ConsoleModule.prototype.printHTML=function(a){this._domElement.innerHTML+=a};NS.ConsoleModule.prototype.clear=function(){this._domElement.innerHTML=""};NS.MediaModule=function(a){this._parentDomElement=a;this._displayedMedia=this._domElement=null;this._mediaList=[];this._isLoaded=!1};
NS.MediaModule.prototype.availableCommands=function(){return["showMedia"]};NS.MediaModule.prototype.performCommand=function(a,b){switch(a){case "showMedia":this.setMedia(this._mediaList[b])}};NS.MediaModule.prototype.isLoaded=function(){return this._isLoaded};NS.MediaModule.prototype.load=function(a,b){this._domElement=document.createElement("div");this._domElement.id="mediaModule";this._isLoaded=!0;b.call(a)};
NS.MediaModule.prototype.show=function(){this._domElement.appendChild(document.createTextNode(""));this._parentDomElement.appendChild(this._domElement)};NS.MediaModule.prototype.hide=function(){this._parentDomElement.removeChild(this._domElement)};NS.MediaModule.prototype.addMedia=function(a){var b=Object.getOwnPropertyNames(a);a=a[b];switch(a.type){case "image":a=new NS.Image(a.url);break;case "video":a=new NS.Video(a.url);break;default:a=new NS.Media("Unknown media type")}this._mediaList[b]=a};
NS.MediaModule.prototype.setMedia=function(a){this._displayedMedia=a;this._domElement.innerHTML=a.htmlContent()};NS.MediaModule.prototype.clear=function(){this._domElement.innerHTML=""};NS.ControlsModule=function(a,b,c,d){this._parentDomElement=a;this._domElement=null;this._caller=b;this._previousStepHandler=c;this._nextStepHandler=d};
NS.ControlsModule.prototype.show=function(){this._domElement=document.createElement("div");this._domElement.id="controlsModule";var a=document.createElement("div"),b=document.createElement("div");a.classList.add("arrow_previous");b.classList.add("arrow_next");var c=this;a.onclick=function(){c._previousStepHandler.call(c._caller)};b.onclick=function(){c._nextStepHandler.call(c._caller)};this._domElement.appendChild(document.createTextNode(""));this._domElement.appendChild(b);this._parentDomElement.appendChild(this._domElement)};
NS.ControlsModule.hide=function(){this._parentDomElement.removeChild(this._domElement)};NS.Media=function(a){this._resourceUrl=a};NS.Media.prototype.htmlContent=function(){return"<p>Resource: "+this._resourceUrl+"</p>"};NS.Image=function(a){NS.Media.call(this,a)};NS.Image.prototype=Object.create(NS.Media.prototype);NS.Image.prototype.constructor=NS.Image;NS.Image.prototype.htmlContent=function(){return'<img src="'+this._resourceUrl+'"></img>'};NS.Video=function(a){NS.Media.call(this,a)};
NS.Video.prototype=Object.create(NS.Media.prototype);NS.Video.prototype.constructor=NS.Video;NS.Video.prototype.htmlContent=function(){if(this._resourceUrl instanceof Array){res="<video controls preload autoplay>\n";for(var a=0;a<this._resourceUrl.length;a++)res+='<source src="'+this._resourceUrl[a]+'"\n>';return res+"</video>"}return'<video src="'+this._resourceUrl+'" type="video/mp4" controls preload autoplay>Votre navigateur ne supporte par les vid\u00e9os MP4. Impossible d\'afficher la vid\u00e9o.</video>'};
NS.Utilities=function(){};NS.Utilities.asyncLoadTextFile=function(a,b,c){var d;window.XMLHttpRequest?(d=new XMLHttpRequest,d.overrideMimeType("text/xml")):window.ActiveXObject&&(d=new ActiveXObject("Microsoft.XMLHTTP"));d.onreadystatechange=function(){4==d.readyState&&c.call(b,d.responseText)};d.open("GET",a,!0);d.send()};
